## 1. NC 财务系统数据库特点分析

### 1.1 数据库架构层次

用友 NC 系统通常采用三层数据架构：

| 层次 | 说明 | 特点 |
| :--- | :--- | :--- |
| **ODS 层** | 原始数据层 | 包含所有原始字段，保留业务系统原始数据 |
| **DW 层** | 数据仓库层 | 经过清洗和处理的宽表，用于分析 |
| **DIM 层** | 维度数据层 | 参照数据、编码表等维度信息 |

> **建议**：在 SQLBot 中主要使用 **DW 层** 和 **DIM 层** 的数据，避免直接使用 ODS 层原始表。

### 1.2 表命名规范

NC 系统表名采用 `模块前缀_业务名称` 的格式：

| 模块前缀 | 业务模块 | 示例表名 |
| :--- | :--- | :--- |
| `gl_` | 总账（General Ledger） | `gl_voucher`, `gl_detail` |
| `ap_` | 应付（Accounts Payable） | `ap_payplan`, `ap_paybill` |
| `ar_` | 应收（Accounts Receivable） | `ar_recbill`, `ar_recplan` |
| `fa_` | 固定资产（Fixed Assets） | `fa_card`, `fa_assetreduce` |
| `bd_` | 基础数据（Base Data） | `bd_accsubj`, `bd_stordoc` |
| `po_` | 采购（Purchase Order） | `po_praybill`, `po_order` |
| `so_` | 销售（Sales Order） | `so_saleorder`, `so_invoiceh` |
| `ic_` | 库存（Inventory Control） | `ic_general_b`, `ic_freeze` |
| `sm_` | 系统管理（System Management） | `sm_busicenter`, `sm_user` |
| `pub_` | 公共模块 | `pub_wf_def`, `pub_billtemplet` |
| `md_` | 元数据（Metadata） | `md_class`, `md_table` |

### 1.3 字段命名规范

| 前缀/后缀 | 含义 | 示例 |
| :--- | :--- | :--- |
| `pk_` | 主键（Primary Key） | `pk_voucher`, `pk_detail` |
| `fk_` | 外键（Foreign Key） | `fk_org`, `fk_accsubj` |
| `dr` | 删除标记（Delete Record） | `dr = 0` 表示未删除 |
| `ts` | 时间戳（Timestamp） | 记录修改时间 |
| `def1` ~ `def50` | 自定义字段 | 用户扩展字段 |
| `_b` | 表体（Body） | `gl_detail_b` 表示凭证分录子表 |
| `_h` | 表头（Head） | `so_invoiceh` 表示销售发票头表 |

### 1.4 常用业务字段

| 字段名 | 含义 | 取值说明 |
| :--- | :--- | :--- |
| `pk_org` | 组织主键 | 财务组织的唯一标识 |
| `pk_group` | 集团主键 | 集团法人的唯一标识 |
| `cyear` | 会计年度 | 四位数字，如 2024 |
| `cmonth` | 会计期间 | 1-12 或 00-12（含调整期） |
| `vouchkind` | 凭证类别 | 记账凭证、收款凭证、付款凭证等 |
| `billstatus` | 单据状态 | 0=保存, 1=已提交, 2=审核中, 3=已审核 |
| `balanorient` | 科目方向 | 0=借方, 1=贷方 |
| `debitamount` | 借方金额 | 原币借方发生额 |
| `creditamount` | 贷方金额 | 原币贷方发生额 |
| `localdebitamount` | 本位币借方 | 本位币借方金额 |
| `localcreditamount` | 本位币贷方 | 本位币贷方金额 |

